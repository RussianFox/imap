# imap
Interactive map for Zabbix

Данная версия разработана для Zabbix версии 3.x

На старых версиях работоспособность не гарантирована и дорабатываться не будет.

Для новых версий разработка будет проводиться по мере выходов официальных релизов.



ВНИМАНИЕ! Пользователи предыдущих бета-версий должны отменить изменения, внесенные в файлы include/menu.inc.php и include/classes/db/DB.php



Для установки скопируйте содержимое папки zabbix в директорию вашего zabbix (/usr/share/zabbix для Debian, например).

Чтобы подключить imap в стандартный интерфейс, отредактируйте include/menu.inc.php
В 314 строку перед "$denied_page_requested = false;" вставьте:

	require_once dirname(__FILE__).'/../imap/menu3.inc.php';

Теперь основной функционал работоспособен. Зайдите в ваш Zabbix и вы увидите новый пункт меню.

Для дополнительных настроек найдите в папке imap файл settings.js.template, переименуйте в settings.js и поменяйте настройки по своему вкусу.

Для собственных дополнений кода (например, добавления своих слоев на карту), переименуйте файл additions.js.template в additions.js и добавьте там свой код.

Для получения ключа API для Bing вам надо получить учетную запись Microsoft и создать новый ключ. Подробности тут http://msdn.microsoft.com/ru-ru/library/ff428642.aspx

Для того, чтобы работали иконки оборудования, вам надо набросать в папку imap/hardware картинок в формате png. Названием будет тип оборудования (modem.png, server.png). Не забудьте дать права на чтение этих файлов веб-сервером. Не удаляйте и не заменяйте файл none.png




## Изменения в базе данных для работы связей

### Для MySQL

Для работы связей между хостами нам нужно добавить две таблицы в базу данных Zabbix.

В папке imap лежит файл tables.sql Вы можете открыть phpmyadmin, выбрать базу данных Zabbix, и выбрать этот файл в разделе Import

Второй способ для любителей командной строки:

`mysql -u user -p zabbixbd < /usr/share/zabbix/imap/tables-mysql.sql`

Замените zabbixbd на название таблицы с данными zabbix, user на имя пользователя с правами добавления таблиц в базу и введите пароль.


### Для PostgreSQL

От рута запустить

`sudo -u zabbix psql -U zabbix -W -d zabbix < table-postgresql.sql`

где

sudo -u zabbix - действия от имени системного пользователя zabbix (иначе PosgreSQL не аутентифицирует пользователя),

-U zabbix - владелец БД,

-d zabbix - название БД.
